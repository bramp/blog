<!DOCTYPE html>
<html lang=en>
<head itemscope itemtype=http://schema.org/WebSite>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link itemprop=url rel=canonical href="https://blog.bramp.net/post/2017/10/02/vanity-go-import-paths/"/>
<title>Vanity Go Import Paths</title>
<meta itemprop=description name=description content="When using third-party packages in Go, they are imported by a path that represents how to download that package from the Internet. For example, to use the popular structured logging library, Logrus, …">
<meta itemprop=creator name=author content="Andrew Brampton">
<meta name=generator content=""/>
<link href=https://blog.bramp.net/index.xml rel=alternate type=application/rss+xml title="bramp.net"/>
<link href=https://blog.bramp.net/index.xml rel=feed type=application/rss+xml title="bramp.net"/>
<link rel="shortcut icon" href=/favicon.ico type="image/x-icon"/>
<link rel=apple-touch-icon-precomposed href="/images/favicon.png"/>
<link rel=apple-touch-icon-precomposed sizes=57x57 href="/images/favicon-57x57.png"/>
<link rel=apple-touch-icon-precomposed sizes=72x72 href="/images/favicon-72x72.png"/>
<link rel=apple-touch-icon-precomposed sizes=76x76 href="/images/favicon-76x76.png"/>
<link rel=apple-touch-icon-precomposed sizes=114x114 href="/images/favicon-114x114.png"/>
<link rel=apple-touch-icon-precomposed sizes=120x120 href="/images/favicon-120x120.png"/>
<link rel=apple-touch-icon-precomposed sizes=144x144 href="/images/favicon-144x144.png"/>
<link rel=apple-touch-icon-precomposed sizes=152x152 href="/images/favicon-152x152.png"/>
<link rel=apple-touch-icon-precomposed sizes=180x180 href="/images/favicon-180x180.png"/>
<meta name=msapplication-TileColor content=#4582EC>
<meta name=msapplication-TileImage content=/images/favicon-144x144.png>
<meta name=theme-color content=#4582EC>
<link rel=icon sizes=192x192 href="/images/favicon-192x192.png"/>
<link href=/css/all.min.css rel=stylesheet>
<link href=https://fonts.gstatic.com rel=preconnect crossorigin>
<link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel=stylesheet type=text/css>
<link href=https://netdna.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/font-hack/2.010/css/hack.min.css>
<meta name=twitter:card content="summary"/>
<meta name=twitter:site content="@TheBramp"/>
<meta name=twitter:creator content="@TheBramp"/>
<meta property=og:type content="article"/>
<meta property=article:author content="https://www.facebook.com/bramp"/>
<meta property=article:published_time content="2017-10-02T07:48:23&#43;07:00"/>
<meta property=article:tag content="Go"/>
<meta property=article:tag content="Goredirects"/>
<meta property=article:tag content="GitHub"/>
<meta property=og:url content="https://blog.bramp.net/post/2017/10/02/vanity-go-import-paths/"/>
<meta property=og:site_name content="bramp.net"/>
<meta property=og:title content="Vanity Go Import Paths"/>
<meta property=og:description content="When using third-party packages in Go, they are imported by a path that represents how to download that package from the Internet. For example, to use the popular structured logging library, Logrus, …"/>
<meta property=og:updated_time content="2017-10-02T07:48:23-07:00"/>
<meta property=og:locale content="en_GB"/>
<meta name=google-site-verification content="RXqIC-7spNUYReoHFlubz8Fbqsg1fC1pE6FSgSnCNjQ"/>
</head>
<body itemscope itemtype=Blog>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-136478-5', 'auto');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');</script>
<div id=wrapper>
<div class="navbar navbar-default">
<div class=container>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<div class=navbar-brand aria-label="About Andrew Brampton">
<a href="/">
<img src=/images/favicon-64x64.png class=profile-image alt=Home>
</a>
<div itemprop=author itemscope itemtype=https://schema.org/Person>
<a href="/about-me/" itemprop=name>Andrew Brampton</a>
<div id=social-wrapper>
<a href=https://twitter.com/TheBramp aria-label=Twitter><i class="fa fa-twitter-square"></i></a>
<a href=https://www.linkedin.com/in/bramp aria-label=LinkedIn><i class="fa fa-linkedin-square"></i></a>
<a href=https://www.facebook.com/bramp aria-label=Facebook><i class="fa fa-facebook-square"></i></a>
<a href=https://github.com/bramp aria-label=GitHub><i class="fa fa-github-square"></i></a>
<a href=https://feeds.feedburner.com/brampnet aria-label="RSS feed"><i class="fa fa-rss-square"></i></a>
</div>
</div>
</div>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav" role=navigation>
<li><a href="/">Articles</a></li>
<li><a href="/about-me/">About Me</a></li>
<li><a href="/android-app/">Android Apps</a></li>
<li><a href="/opensource/">Open Source</a></li>
<li><a href="/publication/">Publications</a></li>
</ul>
</div>
</div>
</div>
<div class="container main">
<article id=article itemProp=blogPost itemscope itemtype=http://schema.org/BlogPosting>
<h1 itemprop=headline>Vanity Go Import Paths</h1>
<p class=meta>
<i class="fa fa-calendar-o"></i> <time itemprop=datePublished>2017-10-02</time>
| <a href="https://blog.bramp.net/tags/go/">Go</a>
| <a href="https://blog.bramp.net/tags/goredirects/">Goredirects</a>
| <a href="https://blog.bramp.net/tags/github/">GitHub</a>
</p>
<div class=post itemprop=articleBody>
<p>When using third-party packages in Go, they are imported by a path that represents how to download that package from the Internet. For example, to use the popular structured logging library, <a href=https://github.com/sirupsen/logrus>Logrus</a>, it would imported at the top of the Go program like so:</p>
<div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=s3e8>import</span> (
  <span class=sc1c>&#34;github.com/sirupsen/logrus&#34;</span>
)</code></pre>
</div>
<p>When <code>go get</code> is then executed, it fetches the Logrus source code from GitHub and places the code in the <code>$GOPATH/src</code> directory. Take a look for yourself:</p>
<div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ tree <span class=s7e3>$GOPATH</span>/src
...
├── github.com
│   ├── Sirupsen
│   │   └── logrus
...</code></pre>
</div>
<p>An astute reader may wonder, how exactly does <code>go get</code> know that <code>github.com/sirupsen/logrus</code> is a Git repository, and that it can be fetched via the git protocol from that URL. The <code>go get</code> binary could have some smarts in it, that knows about GitHub, and does the right thing. But that seems inflexible, and problematic if new sites want to be supported. Instead the Go developers built a layer of indirection that allows the <code>go get</code> tool to discover the correct source repo.</p>
<p>As outlined in the <a href=https://golang.org/cmd/go/#hdr-Remote_import_paths>Remote Import Paths</a> docs, the <code>go get</code> binary will make a normal HTTP request to <code>https://github.com/sirupsen/logrus</code> (falling back to http if needed) and look at the returned HTML for a <code>&lt;meta name=&quot;go-import&quot;</code> tag. This meta tag, can then redirect the <code>go get</code> binary to the correct source code repository for the package.</p>
<p>This meta tag can been seen with <code>curl</code>:</p>
<div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ curl https://github.com/sirupsen/logrus | grep meta | grep go-import</code></pre>
</div><div class=highlight><pre class=chroma><code class=language-html data-lang=html>&lt;<span class=s7e2>meta</span> <span class=s7d1>name</span><span class=sfa0>=</span><span class=sc1c>&#34;go-import&#34;</span>
  <span class=s7d1>content</span><span class=sfa0>=</span><span class=sc1c>&#34;github.com/sirupsen/logrus git https://github.com/sirupsen/logrus.git&#34;</span>&gt;</code></pre>
</div>
<p>That tag says, the package rooted at <code>github.com/sirupsen/logrus</code> can be fetched with git, at the URL <code>https://github.com/sirupsen/logrus.git</code>. The meta tag can express other source control systems, e.g Mercurial, Bazaar, Subversion.</p>
<p>GitHub is a very convenient place to host source code, but the GitHub URL is generic. Instead it is possible to use the <code>&lt;meta&gt;</code> tag to create vanity domains to host projects. For example, the package hosted at <a href=https://github.com/bramp/goredirects>github.com/bramp/goredirects</a> could instead be imported as <code>bramp.net/goredirects</code>. All that is needed is a static HTML page at <code>bramp.net/goredirects</code>, containing the following <code>&lt;meta&gt;</code> tag pointing at GitHub.</p>
<div class=highlight><pre class=chroma><code class=language-html data-lang=html>&lt;<span class=s7e2>meta</span> <span class=s7d1>name</span><span class=sfa0>=</span><span class=sc1c>go-import</span>
  <span class=s7d1>content</span><span class=sfa0>=</span><span class=sc1c>&#34;bramp.net/goredirects git https://github.com/bramp/goredirects.git&#34;</span>&gt;</code></pre>
</div>
<p>Incase a user attempted to visit that page directly with their web browser, it is worthwhile placing more information about the project on the page, or simply making the page redirect.</p>
<p>To help make these redirect pages, I wrote a simple go tool, <code>[goredirects](https://github.com/bramp/goredirects)</code>, that inspects all local repositories under a vanity domain directory in the local <code>$GOPATH/src/</code> and outputs static HTML pages that can be hosted on that domain.</p>
<p>For example, create your new project on GitHub, but check out the project under <code>$GOPATH/src/example.com/project</code>. Then run the tool:</p>
<div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ go install bramp.net/goredirects
$ goredirects example.com outputdir</code></pre>
</div>
<p>The directory <code>outputdir</code> will now contain multiple directories and html files, one for each project under <code>$GOPATH/src/example.com</code>. These HTML files contain the appropriate goimports meta tag to redirect the download of source code from the vanity name, to GitHub. Just upload these files to your website, voilà you are done. Examples of these vanity redirect files can be found on bramp.net, e.g <a href=https://bramp.net/goredirects/index.html>bramp.net/goredirects/index.html</a>. This tool even works for packages with sub-packages under the main root.</p>
<p>Finally, it is possible to ensure that if someone finds your project via GitHub, that <code>go get</code> will always place it under your vanity domain. This be can be achieved with an <a href=https://golang.org/cmd/go/#hdr-Import_path_checking>import comment</a>. Within the source code, ensure that at least one of the files in your page has a comment like so:</p>
<div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=s3e8>package</span> project <span class=sfa0>//</span> <span class=s3e8>import</span> <span class=sc1c>&#34;example.com/project&#34;</span></code></pre>
</div>
<p>Then <code>go get</code> will enforce the correct/vanity URL to use, instead of the true location.</p>
<p>More helpful links on the topic:</p>
<ul>
<li><a href=https://golang.org/cmd/go/#hdr-Import_path_checking>golang.org/cmd/go/#hdr-Import_path_checking</a></li>
<li><a href=https://golang.org/cmd/go/#hdr-Remote_import_paths>golang.org/cmd/go/#hdr-Remote_import_paths</a></li>
<li><a href=https://golang.org/doc/go1.4#canonicalimports>golang.org/doc/go1.4#canonicalimports</a></li>
<li><a href=https://godoc.org/golang.org/x/tools/cmd/fiximports>godoc.org/golang.org/x/tools/cmd/fiximports</a></li>
<li><a href="https://texlution.com/post/golang-canonical-import-paths/">texlution.com/post/golang-canonical-import-paths/</a></li>
</ul>
</div>
</article>
<div class=row>
<div class=col-sm-6>
<div class=addthis_sharing_toolbox></div>
</div>
<div class=col-sm-6>
<div class=btn-toolbar>
<div class=btn-group>
<a class="btn btn-sm btn-soundcloud" href=https://feeds.feedburner.com/brampnet aria-label="RSS feed">
<i class="fa fa-rss-square"></i> Subscribe via RSS</a>
</div>
<div class=btn-group>
<a class="btn btn-sm btn-twitter" href=https://twitter.com/TheBramp><i class="fa fa-twitter"></i> Follow @TheBramp</a>
</div>
</div>
</div>
</div>
<ul class=pager>
&nbsp;<li class=previous><a href="/post/2017/07/15/teaching-binary-to-8th-graders/">&larr; Teaching Binary to 8th Graders</a></li>
</ul>
<div id=disqus_thread itemprop=comment itemscope itemtype=Comment></div>
<script type=text/javascript>var disqus_shortname = 'bramp';
    var disqus_identifier = 'https:\/\/blog.bramp.net\/post\/2017\/10\/02\/vanity-go-import-paths\/';
    var disqus_title = 'Vanity Go Import Paths';
    var disqus_url = 'https:\/\/blog.bramp.net\/post\/2017\/10\/02\/vanity-go-import-paths\/';
    (function() {
	    
	    
	    if (window.location.host.lastIndexOf(":1313") >= 0)
	        return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<br/>
<footer>
<p class="text-muted credit">&copy; 2017. All rights reserved. </p>
</footer>
</div>
</div>
<script src=/js/all.min.js></script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-559846a374d7ecaa" async></script>
</body>
</html>