<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PHP Destructor objects</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo"/>
  <link href="" rel="alternate" type="application/rss+xml" title="bramp.net" />
  <link href="http://bramp.net/blog/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://bramp.net/blog/css/bramp.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  
  
    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-136478-5', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>

<div id = "wrapper">

  <div class="navbar navbar-default" role="navigation">
      <div class="container">

        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-brand">
            <a href="http://bramp.net/blog">
              <img src="//secure.gravatar.com/avatar/69259b422a1a9266e17977f8ec9d939e?s=64" class="profile-image" alt="Home">
            </a>
            <div>
              <a href="http://bramp.net/blog/about-me/">Andrew Brampton</a>

              <div id="social-wrapper">
              
                <a href="https://twitter.com/@TheBramp"><i class="fa fa-twitter-square"></i></a>
              
              
                <a href="https://www.linkedin.com/in/bramp"><i class="fa fa-linkedin-square"></i></a>
              
              
                <a href="https://www.facebook.com/bramp"><i class="fa fa-facebook-square"></i></a>
              
                <a href="https://github.com/bramp"><i class="fa fa-github-square"></i></a>
              
                <a href="http://bramp.net/blog/index.xml"><i class="fa fa-rss-square"></i></a>
             </div>
            </div>
          </div>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="http://bramp.net/blog/about-me/">About Me</a></li>
            <li><a href="http://bramp.net/blog/android-apps/">Android Apps</a></li>
            <li><a href="http://bramp.net/blog/posts/">Articles</a></li>
            <li><a href="http://bramp.net/blog/opensource-projects/">Open Source</a></li>
            <li><a href="http://bramp.net/blog/publications/">Publications</a></li>
          </ul>
        </div>
      </div>
    </div>

     <div class="container main">


  <div id="article">
   <h1>PHP Destructor objects</h1>
   <p class="meta"><small>&nbsp;<i class="fa fa-calendar-o"></i> 2011-11-02</small> 289 words</p> <hr/>
   <div class="post">
     <p>PHP&#8217;s lack of a finally keyword is apalling, and even though there seems to be some hacks around it, I have come up with own today. I&#8217;m following the C++ concept of allocating objects on the stack, and letting them cleanup any resources when the stack is rolled back.</p>

<p>Take an example. I am creating some files that I want to always be deleted after the script has finished. In any sane language (that has Exceptions) I would write:</p>

<pre class="prettyprint">try {
  // Create files
  // Do something with the files
} finally {
  // Delete files - This code will run no matter what exceptions or errors occur while creating the files.
}
</pre>

<p>However, this is the hack I&#8217;ve managed with PHP:</p>

<pre class="prettyprint">class UnlinkMe {
    var $filename;

    function __construct($filename) {
        $this-&gt;filename = $filename;
    }

    function __destruct() {
        unlink($this-&gt;filename);
    }
}

// To use:
function doSomething() {
  $unlinkme = new UnlinkMe('/tmp/filename'):

  // Do some work with the files

  return;
}
</pre>

<p>Here we are creating a UnlinkMe object, that has a destructor set up to delete a file. This UnlinkMe object is only used in the doSomething() function. Once that function returns, there are no longer any references to the object. When PHP decides to garbage collect (to free up some memory), it will destroy the UnlinkMe object, and thus call the __destruct method. Voila, we now call unlink and have cleaned up the file, even after the script has finished running.</p>

<p>There is lots of room for improvement, and this technique has lots of gotchas. For example, PHP has some bizzare rules for when __destruct method will not be called. So please don&#8217;t rely on this technique, but it might be useful, and keep your code cleaner and more organised.</p>

   </div>
 </div>


 <a href="https://twitter.com/share" class="twitter-share-button " data-size="small" data-count="none">Tweet</a>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

 <ul class="pager">
      &nbsp;<li class="previous"><a href="http://bramp.net/blog/2011/11/08/archive-mount/">&larr; Archive Mount</a></li>
      &nbsp;<li class="next"><a href="http://bramp.net/blog/2011/10/31/2010-census-tiger/linesup/sup-shapefiles-code-names/"> 2010 Census TIGER/Line&lt;sup&gt;Â®&lt;/sup&gt; Shapefiles Code Names &rarr;</a></li>
</ul>

<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost" || window.location.port == 1313) 
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = '';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <footer>
        <p class="text-muted credit">&copy; 2015. All rights reserved. </p>
    </footer>

    </div> 
    </div> 

	
    <script src="http://bramp.net/blog/js/jquery-1.10.2.min.js"></script>
    <script src="http://bramp.net/blog/js/bootstrap.min.js"></script>
  </body>
</html>

