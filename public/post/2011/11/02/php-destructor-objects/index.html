<!DOCTYPE html><html lang=en><head><meta charset=utf-8><title>PHP Destructor objects</title><meta name=description content=""><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo"/><link rel=canonical href="https://blog.bramp.net/post/2011/11/02/php-destructor-objects/"/><link href="" rel=alternate type=application/rss+xml title="PHP Destructor objects"/><link href=/css/bootstrap.min.css rel=stylesheet><link href=/css/bramp.css rel=stylesheet><link href=/css/pygments-friendly.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet><meta name=twitter:card content="summary"/><meta name=twitter:site content="@TheBramp"/><meta name=twitter:title content="PHP Destructor objects"/><meta name=twitter:description content=""/><meta name=google-site-verification content="RXqIC-7spNUYReoHFlubz8Fbqsg1fC1pE6FSgSnCNjQ"/><script></script><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-136478-5', 'auto');
    ga('send', 'pageview');</script><div id=wrapper><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button><div class=navbar-brand><a href="/"><img src="//secure.gravatar.com/avatar/69259b422a1a9266e17977f8ec9d939e?s=64" class=profile-image alt=Home></a><div><a href="/about-me/">Andrew Brampton</a><div id=social-wrapper><a href=https://twitter.com/TheBramp><i class="fa fa-twitter-square"></i></a> <a href=https://www.linkedin.com/in/bramp><i class="fa fa-linkedin-square"></i></a> <a href=https://www.facebook.com/bramp><i class="fa fa-facebook-square"></i></a> <a href=https://github.com/bramp><i class="fa fa-github-square"></i></a> <a href=/index.xml><i class="fa fa-rss-square"></i></a></div></div></div></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href="/">Articles</a></li><li><a href="/about-me/">About Me</a></li><li><a href="/android-app/">Android Apps</a></li><li><a href="/opensource-project/">Open Source</a></li><li><a href="/publication/">Publications</a></li></ul></div></div></div><div class="container main"><div id=article><h1>PHP Destructor objects</h1><p class=meta><i class="fa fa-calendar-o"></i> 2011-11-02 | <a href="https://blog.bramp.net/tags/hack/">hack</a> | <a href="https://blog.bramp.net/tags/php/">PHP</a></p><div class=post><p>PHP&#8217;s lack of a finally keyword is apalling, and even though there seems to be some hacks around it, I have come up with own today. I&#8217;m following the C++ concept of allocating objects on the stack, and letting them cleanup any resources when the stack is rolled back.</p><p>Take an example. I am creating some files that I want to always be deleted after the script has finished. In any sane language (that has Exceptions) I would write:</p><div class=highlight><pre><span class=k>try</span> <span class=p>{</span>
  <span class=c1>// Create files</span>
  <span class=c1>// Do something with the files</span>
<span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
  <span class=c1>// Delete files - This code will run no matter what exceptions or errors occur while creating the files.</span>
<span class=p>}</span>
</pre></div><p>However, this is the hack I&#8217;ve managed with PHP:</p><div class=highlight><pre><span class=k>class</span> <span class=nc>UnlinkMe</span> <span class=p>{</span>
    <span class=k>var</span> <span class=nv>$filename</span><span class=p>;</span>

    <span class=k>function</span> <span class=nf>__construct</span><span class=p>(</span><span class=nv>$filename</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span> <span class=o>=</span> <span class=nv>$filename</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>function</span> <span class=nf>__destruct</span><span class=p>()</span> <span class=p>{</span>
        <span class=nb>unlink</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// To use:</span>
<span class=k>function</span> <span class=nf>doSomething</span><span class=p>()</span> <span class=p>{</span>
  <span class=nv>$unlinkme</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UnlinkMe</span><span class=p>(</span><span class=s1>&#39;/tmp/filename&#39;</span><span class=p>)</span><span class=o>:</span>

  <span class=c1>// Do some work with the files</span>

  <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
</pre></div><p>Here we are creating a UnlinkMe object, that has a destructor set up to delete a file. This UnlinkMe object is only used in the doSomething() function. Once that function returns, there are no longer any references to the object. When PHP decides to garbage collect (to free up some memory), it will destroy the UnlinkMe object, and thus call the __destruct method. Voila, we now call unlink and have cleaned up the file, even after the script has finished running.</p><p>There is lots of room for improvement, and this technique has lots of gotchas. For example, PHP has some bizzare rules for when __destruct method will not be called. So please don&#8217;t rely on this technique, but it might be useful, and keep your code cleaner and more organised.</p></div></div><div class=addthis_sharing_toolbox></div><ul class=pager>&nbsp;<li class=previous><a href="/post/2011/10/31/2010-census-tiger/line-shapefiles-code-names/">&larr; 2010 Census TIGER/LineÂ® Shapefiles Code Names</a></li>&nbsp;<li class=next><a href="/post/2011/11/08/archive-mount/">Archive Mount &rarr;</a></li></ul><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'bramp';


(function() {

    
    
    if (window.location.hostname == "localhost" || window.location.port == 1313) 
        return;


    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><br/><footer><p class="text-muted credit">&copy; 2015. All rights reserved.</p></footer></div></div><script src=/js/jquery-1.10.2.min.js></script><script src=/js/bootstrap.min.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-559846a374d7ecaa" async></script>