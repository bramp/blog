<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <title>Obtaining the firmware for Linksys E4200v2</title> <meta name=description content=""> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=generator content="Hugo"/> <link rel=canonical href="https://bramp.github.io/post/2012/01/22/obtaining-the-firmware-for-linksys-e4200v2/"/> <link href="" rel=alternate type=application/rss+xml title="Obtaining the firmware for Linksys E4200v2"/> <link href=/css/bootstrap.min.css rel=stylesheet> <link href=/css/bramp.css rel=stylesheet> <link href=/css/pygments-friendly.css rel=stylesheet> <link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet> <meta name=twitter:card content="summary"/> <meta name=twitter:site content="@TheBramp"/> <meta name=twitter:title content="Obtaining the firmware for Linksys E4200v2"/> <meta name=twitter:description content=""/> <body> <script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-136478-5","auto"),ga("send","pageview");</script><div id=wrapper> <div class="navbar navbar-default" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span>    </button> <div class=navbar-brand> <a href="/"> <img src="//secure.gravatar.com/avatar/69259b422a1a9266e17977f8ec9d939e?s=64" class=profile-image alt=Home> </a> <div> <a href="/about-me/">Andrew Brampton</a> <div id=social-wrapper> <a href=https://twitter.com/TheBramp></a> <a href=https://www.linkedin.com/in/bramp></a> <a href=https://www.facebook.com/bramp></a> <a href=https://github.com/bramp></a> <a href=/index.xml></a> </div> </div> </div> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li><a href="/">Articles</a></li> <li><a href="/about-me/">About Me</a></li> <li><a href="/android-app/">Android Apps</a></li> <li><a href="/opensource-project/">Open Source</a></li> <li><a href="/publication/">Publications</a></li> </ul> </div> </div> </div> <div class="container main"> <div id=article> <h1>Obtaining the firmware for Linksys E4200v2</h1> <p class=meta>  2012-01-22 | <a href=https://bramp.github.io/tags/firmware>firmware</a> | <a href=https://bramp.github.io/tags/linksys>linksys</a> | <a href=https://bramp.github.io/tags/linux>Linux</a> | <a href=https://bramp.github.io/tags/router>router</a> </p> <div class=post> <p>I recently got a Linksys E4200v2 wireless router. It&#8217;s pretty cool, supports IPv6, 2.4Ghz and 5Ghz wifi networks, VPN, etc. The one downside is that the firmware for the router is not available from <a href=http://homesupport.cisco.com/en-us/wireless/linksys/E4200>Linksys&#8217;s website</a>, and the <a href=http://homesupport.cisco.com/en-us/gplcodecenter>GPL code</a> has not been made available, yet&#8230; However, the router has been able to pull updates itself from the Internet.</p> <p>So I wanted to acquire the firmware to see if I could do something fun with the router. I set about to figure out how the router does this. My plan was to set my laptop up between Internet interface on the router, and the cable modem. Since my laptop doesn&#8217;t have two network cards, I plugged into a switch and used <a href="http://ettercap.sourceforge.net/">Ethercap</a> to ARP poison to redirect traffic via the laptop.</p> <p>Then using <a href="http://www.wireshark.org/">Wireshark</a> I could see the traffic coming out of the router. All I needed to do now was to hit the &#8220;check for updates button&#8221;.</p> <p>Firstly I saw two DNS requests, one for the AAAA (IPv6) record for update.linksys.com, then a A request for update.linksys.com. Clearly the updates are coming from there. Secondly I saw a HTTPS connection form to that domain. That makes this a little more complex, as I am unable to see the encrypted traffic, and thus see what is being transferred.</p> <p>So, I grabbed a <a href="http://code.activestate.com/recipes/491264-mini-fake-dns-server/">simple DNS server</a>, and set up a simple SSL server following <a href="http://wirewatcher.wordpress.com/2010/07/20/decrypting-ssl-traffic-with-wireshark-and-ways-to-prevent-it/">these instructions</a>.</p> <p>Now with DNS spoofing, and a fake SSL server, I could intercept encrypted traffic from the router, as long as it does not validate the SSL certificate. Luckily it didn&#8217;t check the validity, and thus I was able to capture the request: (BTW Not checking the cert completely defeats the point of using SSL&#8230; bad Linksys!).</p> <div class=highlight><pre><span class=nf>POST</span> <span class=nn>/cds/update</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=na>Host</span><span class=o>:</span> <span class=l>update.linksys.com</span>
<span class=na>Accept</span><span class=o>:</span> <span class=l>*/*</span>
<span class=na>Content-Type</span><span class=o>:</span> <span class=l>text/xml</span>
<span class=na>Content-Length</span><span class=o>:</span> <span class=l>573</span>

<span class=nt>&lt;SOAP-ENV:Envelope</span> <span class=na>xmlns:SOAP-ENV=</span><span class=s>&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span><span class=nt>&gt;</span>
  <span class=nt>&lt;SOAP-ENV:Header/&gt;</span>
  <span class=nt>&lt;SOAP-ENV:Body&gt;</span>
    <span class=nt>&lt;ns:GetFirmwareFromDeviceRequest</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>
      <span class=nt>&lt;ns:LanguageCode&gt;</span>en<span class=nt>&lt;/ns:LanguageCode&gt;</span>
      <span class=nt>&lt;ns:CountryCode&gt;</span>us<span class=nt>&lt;/ns:CountryCode&gt;</span>
      <span class=nt>&lt;ns:MacAddress&gt;</span>12:34:56:78:90:ab<span class=nt>&lt;/ns:MacAddress&gt;</span>
      <span class=nt>&lt;ns:ModelNo&gt;</span>E4200<span class=nt>&lt;/ns:ModelNo&gt;</span>
      <span class=nt>&lt;ns:HardwareVersion&gt;</span>2<span class=nt>&lt;/ns:HardwareVersion&gt;</span>
      <span class=nt>&lt;ns:CurrentFirmwareVersion&gt;</span>2.0.36.126507<span class=nt>&lt;/ns:CurrentFirmwareVersion&gt;</span>
    <span class=nt>&lt;/ns:GetFirmwareFromDeviceRequest&gt;</span>
  <span class=nt>&lt;/SOAP-ENV:Body&gt;</span>
<span class=nt>&lt;/SOAP-ENV:Envelope&gt;</span>
</pre></div> <p>and the response:</p> <div class=highlight><pre><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
<span class=na>Content-Language</span><span class=o>:</span> <span class=l>en-US</span>
<span class=na>Content-Type</span><span class=o>:</span> <span class=l>text/xml</span>
<span class=na>SOAPAction</span><span class=o>:</span> <span class=l>&quot;&quot;</span>

<span class=nt>&lt;soapenv:Envelope</span>
 <span class=na>xmlns:soapenv=</span><span class=s>&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>
 <span class=na>xmlns:soapenc=</span><span class=s>&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>
 <span class=na>xmlns:xsd=</span><span class=s>&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
 <span class=na>xmlns:xsi=</span><span class=s>&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class=nt>&gt;</span>
  <span class=nt>&lt;soapenv:Header/&gt;</span>
  <span class=nt>&lt;soapenv:Body&gt;</span>
    <span class=nt>&lt;ns:GetFirmwareFromDeviceResponse</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>
      <span class=nt>&lt;ns:FirmwareList</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;ns:Firmware</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>
          <span class=nt>&lt;ns:Version</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>2.0.36.126507<span class=nt>&lt;/ns:Version&gt;</span>
          <span class=nt>&lt;ns:Revision</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>D<span class=nt>&lt;/ns:Revision&gt;</span>
          <span class=nt>&lt;ns:ReleaseDate</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>2012-01-06T16:48:08Z<span class=nt>&lt;/ns:ReleaseDate&gt;</span>
          <span class=nt>&lt;ns:DownloadURI</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>http://download.linksys.com/updates/to0037258865.pdx/FW_E4200_2.0.36.126507.SSA<span class=nt>&lt;/ns:DownloadURI&gt;</span>
          <span class=nt>&lt;ns:DateFormat</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>yyyy-MM-dd&#39;;T&#39;;HH:mm:ss&#39;;Z&#39;;<span class=nt>&lt;/ns:DateFormat&gt;</span>
          <span class=nt>&lt;ns:Checksum</span> <span class=na>xmlns:ns=</span><span class=s>&quot;http://cisco.com/schemas&quot;</span><span class=nt>&gt;</span>1958710861<span class=nt>&lt;/ns:Checksum&gt;</span>
        <span class=nt>&lt;/ns:Firmware&gt;</span>
      <span class=nt>&lt;/ns:FirmwareList&gt;</span>
    <span class=nt>&lt;/ns:GetFirmwareFromDeviceResponse&gt;</span>
  <span class=nt>&lt;/soapenv:Body&gt;</span>
<span class=nt>&lt;/soapenv:Envelope&gt;</span>
</pre></div> <p>(I slightly modified portions of the request and response to hide the identify of my router.).</p> <p>I might write a script to make fake requests, but until then you can easily create a request with curl:</p> <div class=highlight><pre>curl -d @request.raw https://update.linksys.com/cds/update
</pre></div> <p>Then you just extract the DownloadURI and</p> <div class=highlight><pre>curl http://download.linksys.com/updates/to0037258865.pdx/FW_E4200_2.0.36.126507.SSA
</pre></div> <p>Voila I now have the firmware. Now I need to figure out what to do with it.</p> <p><strong>Update</strong>: As requested I fetched the more recent version of the file:<br/> 2.0.37.131047 &#8211; <a href=http://download.linksys.com/updates/to0040829450.pdx/FW_E4200_2.0.37.131047.SSA>http://download.linksys.com/updates/to0040829450.pdx/FW_E4200_2.0.37.131047.SSA</a></p> </div> </div>  <ul class=pager> &nbsp;<li class=previous><a href="/post/2012/01/14/avoid-bloat-freezer-free/">&larr; Avoid Bloat Freezer Free</a></li> &nbsp;<li class=next><a href="/post/2012/01/24/hacking-linksys-e4200v2-firmware/"> Hacking Linksys E4200v2 firmware &rarr;</a></li> </ul>  <script type=text/javascript>!function(){if("localhost"!=window.location.hostname&&1313!=window.location.port){var e=document.createElement("script");e.type="text/javascript",e.async=!0;var t="";e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> <br/> <footer> <p class="text-muted credit">&copy; 2015. All rights reserved. </p> </footer> </div> </div> <script src=/js/jquery-1.10.2.min.js></script><script src=/js/bootstrap.min.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-559846a374d7ecaa" async></script>