<!DOCTYPE html>
<html lang=en>
<head itemscope itemtype=http://schema.org/WebSite>
<meta charset=utf-8>
<meta content="width=device-width,initial-scale=1" name=viewport>
<link href=https://blog.bramp.net/post/2012/01/22/obtaining-the-firmware-for-linksys-e4200v2/ rel=canonical itemprop=url />
<title>Obtaining the firmware for Linksys E4200v2</title>
<meta content="I recently got a Linksys E4200v2 wireless router. It’s pretty cool, supports IPv6, 2.4Ghz and 5Ghz wifi networks, VPN, etc. The one downside is that the firmware for the router is not available from …" name=description itemprop=description>
<meta content="Andrew Brampton" name=author itemprop=creator>
<meta content="" name=generator />
<link href=https://blog.bramp.net/index.xml rel=alternate type=application/rss+xml title=bramp.net />
<link href=https://blog.bramp.net/index.xml rel=feed type=application/rss+xml title=bramp.net />
<meta content=#4582EC name=theme-color>
<link href=/favicon.ico rel="shortcut icon" type=image/x-icon />
<link href=/images/favicon.png rel=apple-touch-icon />
<link href=/images/favicon-57x57.png rel=apple-touch-icon sizes=57x57 />
<link href=/images/favicon-72x72.png rel=apple-touch-icon sizes=72x72 />
<link href=/images/favicon-76x76.png rel=apple-touch-icon sizes=76x76 />
<link href=/images/favicon-114x114.png rel=apple-touch-icon sizes=114x114 />
<link href=/images/favicon-120x120.png rel=apple-touch-icon sizes=120x120 />
<link href=/images/favicon-144x144.png rel=apple-touch-icon sizes=144x144 />
<link href=/images/favicon-152x152.png rel=apple-touch-icon sizes=152x152 />
<link href=/images/favicon-180x180.png rel=apple-touch-icon sizes=180x180 />
<meta content=#4582EC name=msapplication-TileColor>
<meta content=/images/favicon-144x144.png name=msapplication-TileImage>
<link href=/images/favicon-192x192.png rel=icon sizes=192x192 />
<link href=/css/all.8552e60cc1cd059f570fddaa29e58121.min.css rel=stylesheet>
<link href=/css/sortable-theme-minimal.css rel=stylesheet />
<link href=https://cdn.jsdelivr.net/font-hack/2.010/css/hack.min.css rel=stylesheet>
<script src="https://www.googletagmanager.com/gtag/js?id=UA-136478-5" async></script>
<script>
window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-136478-5');
</script>
<meta content=summary name=twitter:card />
<meta content=@TheBramp name=twitter:site />
<meta content=@TheBramp name=twitter:creator />
<meta content=article property=og:type />
<meta content=https://www.facebook.com/bramp property=article:author />
<meta content=2012-01-22T00:00:00&#43;07:00 property=article:published_time />
<meta content=firmware property=article:tag />
<meta content=linksys property=article:tag />
<meta content=Linux property=article:tag />
<meta content=router property=article:tag />
<meta content=https://blog.bramp.net/post/2012/01/22/obtaining-the-firmware-for-linksys-e4200v2/ property=og:url />
<meta content=bramp.net property=og:site_name />
<meta content="Obtaining the firmware for Linksys E4200v2" property=og:title />
<meta content="I recently got a Linksys E4200v2 wireless router. It’s pretty cool, supports IPv6, 2.4Ghz and 5Ghz wifi networks, VPN, etc. The one downside is that the firmware for the router is not available from …" property=og:description />
<meta content=2012-01-22T00:00:00&#43;00:00 property=og:updated_time />
<meta content=en_GB property=og:locale />
<meta content=RXqIC-7spNUYReoHFlubz8Fbqsg1fC1pE6FSgSnCNjQ name=google-site-verification />
</head>
<body itemscope itemtype=Blog>
<div id=wrapper>
<nav class="navbar navbar-default">
<div class=container>
<div class=navbar-header>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse type=button>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<div class=navbar-brand aria-label="About Andrew Brampton">
<a href=/ >
<img alt=Home class=profile-image height=72 src=/images/favicon-72x72.png srcset="/images/favicon-72x72.png, /images/favicon-144x144.png 2x" width=72>
</a>
<div itemprop=author itemscope itemtype=https://schema.org/Person>
<a href=/about-me/ itemprop=name>Andrew Brampton</a>
<div id=social-wrapper>
<a href=https://twitter.com/TheBramp aria-label=Twitter><svg class="icon icon-twitter-square"><use xlink:href=/images/icons.svg#icon-twitter-square></use></svg></a>
<a href=https://www.linkedin.com/in/bramp aria-label=LinkedIn><svg class="icon icon-linkedin-square"><use xlink:href=/images/icons.svg#icon-linkedin-square></use></svg></a>
<a href=https://www.facebook.com/bramp aria-label=Facebook><svg class="icon icon-facebook-square"><use xlink:href=/images/icons.svg#icon-facebook-square></use></svg></a>
<a href=https://github.com/bramp aria-label=GitHub><svg class="icon icon-github-square"><use xlink:href=/images/icons.svg#icon-github-square></use></svg></a>
<a href=https://feeds.feedburner.com/brampnet aria-label="RSS feed"><svg class="icon icon-github-square"><use xlink:href=/images/icons.svg#icon-rss-square></use></svg></a>
</div>
</div>
</div>
</div>
<div class="collapse navbar-collapse">
<ul class="nav navbar-nav" role=navigation>
<li><a href=/ >Articles</a></li>
<li><a href=/about-me/ >About Me</a></li>
<li><a href=/android-app/ >Android Apps</a></li>
<li><a href=/opensource/ >Open Source</a></li>
<li><a href=/publication/ >Publications</a></li>
</ul>
</div>
</div>
</nav>
<div class="container main">
<main>
<article id=article itemProp=blogPost itemscope itemtype=http://schema.org/BlogPosting>
<h1 itemprop=headline>Obtaining the firmware for Linksys E4200v2</h1>
<p class=meta>
<svg class="icon icon-calendar"><use xlink:href=/images/icons.svg#icon-calendar></use></svg> <time itemprop=datePublished>2012-01-22</time>
| <a href=https://blog.bramp.net/tags/firmware/ >firmware</a>
| <a href=https://blog.bramp.net/tags/linksys/ >linksys</a>
| <a href=https://blog.bramp.net/tags/linux/ >Linux</a>
| <a href=https://blog.bramp.net/tags/router/ >router</a>
</p>
<div class=post itemprop=articleBody>
<p>I recently got a Linksys E4200v2 wireless router. It’s pretty cool, supports IPv6, 2.4Ghz and 5Ghz wifi networks, VPN, etc. The one downside is that the firmware for the router is not available from <a href=http://homesupport.cisco.com/en-us/wireless/linksys/E4200>Linksys’s website</a>, and the <a href=http://homesupport.cisco.com/en-us/gplcodecenter>GPL code</a> has not been made available, yet… However, the router has been able to pull updates itself from the Internet.</p>
<p>So I wanted to acquire the firmware to see if I could do something fun with the router. I set about to figure out how the router does this. My plan was to set my laptop up between Internet interface on the router, and the cable modem. Since my laptop doesn’t have two network cards, I plugged into a switch and used <a href=http://ettercap.sourceforge.net/ >Ethercap</a> to ARP poison to redirect traffic via the laptop.</p>
<p>Then using <a href=http://www.wireshark.org/ >Wireshark</a> I could see the traffic coming out of the router. All I needed to do now was to hit the “check for updates button”.</p>
<p>Firstly I saw two DNS requests, one for the AAAA (IPv6) record for update.linksys.com, then a A request for update.linksys.com. Clearly the updates are coming from there. Secondly I saw a HTTPS connection form to that domain. That makes this a little more complex, as I am unable to see the encrypted traffic, and thus see what is being transferred.</p>
<p>So, I grabbed a <a href=http://code.activestate.com/recipes/491264-mini-fake-dns-server/ >simple DNS server</a>, and set up a simple SSL server following <a href=http://wirewatcher.wordpress.com/2010/07/20/decrypting-ssl-traffic-with-wireshark-and-ways-to-prevent-it/ >these instructions</a>.</p>
<p>Now with DNS spoofing, and a fake SSL server, I could intercept encrypted traffic from the router, as long as it does not validate the SSL certificate. Luckily it didn’t check the validity, and thus I was able to capture the request: (BTW Not checking the cert completely defeats the point of using SSL… bad Linksys!).</p>
<div class=highlight><pre class=chroma><code class=language-http data-lang=http><span class=nf>POST</span> <span class=nn>/cds/update</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=n>Host</span><span class=o>:</span> <span class=l>update.linksys.com</span>
<span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/xml</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>573</span>

<span class=ni>&amp;lt;</span>SOAP-ENV:Envelope xmlns:SOAP-ENV=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;<span class=ni>&amp;gt;</span>
  <span class=ni>&amp;lt;</span>SOAP-ENV:Header/<span class=ni>&amp;gt;</span>
  <span class=ni>&amp;lt;</span>SOAP-ENV:Body<span class=ni>&amp;gt;</span>
    <span class=ni>&amp;lt;</span>ns:GetFirmwareFromDeviceRequest xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:LanguageCode<span class=ni>&amp;gt;</span>en<span class=ni>&amp;lt;</span>/ns:LanguageCode<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:CountryCode<span class=ni>&amp;gt;</span>us<span class=ni>&amp;lt;</span>/ns:CountryCode<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:MacAddress<span class=ni>&amp;gt;</span>12:34:56:78:90:ab<span class=ni>&amp;lt;</span>/ns:MacAddress<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:ModelNo<span class=ni>&amp;gt;</span>E4200<span class=ni>&amp;lt;</span>/ns:ModelNo<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:HardwareVersion<span class=ni>&amp;gt;</span>2<span class=ni>&amp;lt;</span>/ns:HardwareVersion<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:CurrentFirmwareVersion<span class=ni>&amp;gt;</span>2.0.36.126507<span class=ni>&amp;lt;</span>/ns:CurrentFirmwareVersion<span class=ni>&amp;gt;</span>
    <span class=ni>&amp;lt;</span>/ns:GetFirmwareFromDeviceRequest<span class=ni>&amp;gt;</span>
  <span class=ni>&amp;lt;</span>/SOAP-ENV:Body<span class=ni>&amp;gt;</span>
<span class=ni>&amp;lt;</span>/SOAP-ENV:Envelope<span class=ni>&amp;gt;</span>
</code></pre></div><p>and the response:</p>
<div class=highlight><pre class=chroma><code class=language-http data-lang=http><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
<span class=n>Content-Language</span><span class=o>:</span> <span class=l>en-US</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/xml</span>
<span class=n>SOAPAction</span><span class=o>:</span> <span class=l>&#34;&#34;</span>

<span class=ni>&amp;lt;</span>soapenv:Envelope
 xmlns:soapenv=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;
 xmlns:soapenc=&#34;http://schemas.xmlsoap.org/soap/encoding/&#34;
 xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34;
 xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<span class=ni>&amp;gt;</span>
  <span class=ni>&amp;lt;</span>soapenv:Header/<span class=ni>&amp;gt;</span>
  <span class=ni>&amp;lt;</span>soapenv:Body<span class=ni>&amp;gt;</span>
    <span class=ni>&amp;lt;</span>ns:GetFirmwareFromDeviceResponse xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>ns:FirmwareList xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>
        <span class=ni>&amp;lt;</span>ns:Firmware xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>
          <span class=ni>&amp;lt;</span>ns:Version xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>2.0.36.126507<span class=ni>&amp;lt;</span>/ns:Version<span class=ni>&amp;gt;</span>
          <span class=ni>&amp;lt;</span>ns:Revision xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>D<span class=ni>&amp;lt;</span>/ns:Revision<span class=ni>&amp;gt;</span>
          <span class=ni>&amp;lt;</span>ns:ReleaseDate xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>2012-01-06T16:48:08Z<span class=ni>&amp;lt;</span>/ns:ReleaseDate<span class=ni>&amp;gt;</span>
          <span class=ni>&amp;lt;</span>ns:DownloadURI xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>http://download.linksys.com/updates/to0037258865.pdx/FW_E4200_2.0.36.126507.SSA<span class=ni>&amp;lt;</span>/ns:DownloadURI<span class=ni>&amp;gt;</span>
          <span class=ni>&amp;lt;</span>ns:DateFormat xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>yyyy-MM-dd&#39;;T&#39;;HH:mm:ss&#39;;Z&#39;;<span class=ni>&amp;lt;</span>/ns:DateFormat<span class=ni>&amp;gt;</span>
          <span class=ni>&amp;lt;</span>ns:Checksum xmlns:ns=&#34;http://cisco.com/schemas&#34;<span class=ni>&amp;gt;</span>1958710861<span class=ni>&amp;lt;</span>/ns:Checksum<span class=ni>&amp;gt;</span>
        <span class=ni>&amp;lt;</span>/ns:Firmware<span class=ni>&amp;gt;</span>
      <span class=ni>&amp;lt;</span>/ns:FirmwareList<span class=ni>&amp;gt;</span>
    <span class=ni>&amp;lt;</span>/ns:GetFirmwareFromDeviceResponse<span class=ni>&amp;gt;</span>
  <span class=ni>&amp;lt;</span>/soapenv:Body<span class=ni>&amp;gt;</span>
<span class=ni>&amp;lt;</span>/soapenv:Envelope<span class=ni>&amp;gt;</span>
</code></pre></div><p>(I slightly modified portions of the request and response to hide the identify of my router.).</p>
<p>I might write a script to make fake requests, but until then you can easily create a request with curl:</p>
<div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>curl -d @request.raw https://update.linksys.com/cds/update
</code></pre></div><p>Then you just extract the DownloadURI and</p>
<div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>curl http://download.linksys.com/updates/to0037258865.pdx/FW_E4200_2.0.36.126507.SSA
</code></pre></div><p>Voila I now have the firmware. Now I need to figure out what to do with it.</p>
<p><strong>Update</strong>: As requested I fetched the more recent version of the file:<br>
2.0.37.131047 – <a href=http://download.linksys.com/updates/to0040829450.pdx/FW>http://download.linksys.com/updates/to0040829450.pdx/FW</a>_E4200_2.0.37.131047.SSA</p>
</div>
</article>
<div class=row>
<hr/>
<div class=col-sm-6>
</div>
<div class=col-sm-6>
<div class=btn-toolbar>
<div class=btn-group>
<a href=https://feeds.feedburner.com/brampnet aria-label="RSS feed" class="btn btn-sm btn-soundcloud"><svg class="icon icon-rss"><use xlink:href=/images/icons.svg#icon-rss></use></svg> Subscribe via RSS</a>
</div>
<div class=btn-group>
<a href=https://twitter.com/TheBramp class="btn btn-sm btn-twitter"><svg class="icon icon-twitter"><use xlink:href=/images/icons.svg#icon-twitter></use></svg> Follow @TheBramp</a>
</div>
</div>
</div>
</div>
<ul class=pager>
&nbsp;<li class=previous><a href=/post/2012/01/14/avoid-bloat-freezer-free/ >&larr; Avoid Bloat Freezer Free</a></li>
&nbsp;<li class=next><a href=/post/2012/01/24/hacking-linksys-e4200v2-firmware/ >Hacking Linksys E4200v2 firmware &rarr;</a></li>
</ul>
</main>
<br/>
<footer>
<p class="credit text-muted">&copy; 2021. All rights reserved.</p>
</footer>
</div>
</div>
<script src=/js/all.421bdc0798a792d922b399e8180168e3.min.js></script>
<script src=/js/sortable.min.js></script>
</body>
</html>
